<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <title>Title</title>

    <script src="jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
        window.onload = function (){
            awake();
            getcon("mybtn").onclick = function (){
                abc();
            }
        };
        function awake(){
            setInterval(getnewmes,1500);
        }

        function getnewmes(){
            $.ajax({
                url:"http://cloud.bmob.cn/974f094180354da9/getmess",
                type: 'GET',
                dataType: 'jsonp',  // 请求方式为jsonp
                jsonp: 'callback',
                jsonpCallback:"callbackFunction",
                success:function(result) {
                    var jobj = JSON.parse(JSON.stringify(result));
                    var str = "";
                    getcon("mygetmess").innerText = "";
                    for (var i in jobj)
                    {
                        getcon("mygetmess").innerText += jobj[i].toString() + "\r\n";
                        // for (var i2 of i)
                        // {
                        //     str += i2.toString() + "(::)";
                        //
                        // }
                    }
                    getcon("mylabget").value = jobj;
                }
            });
        }

        function getcon(id){
            return document.getElementById(id);
        }

        async function abc(){
            var mresult;
            // alert(mydata);
            await $.ajax({
                url:"http://cloud.bmob.cn/974f094180354da9/talk?name=" + getcon("myname").value + "&password=" + getcon(
                    "mypswd").value + "&word=" + getcon("mylabsend").value,
                type: 'GET',
                dataType: 'jsonp',  // 请求方式为jsonp
                jsonp: 'callback',
                jsonpCallback:"callbackFunction",
                success:function(result) {
                    mresult = result;
                }
            });
            if (mresult === "NULL_PE")
            {
                addcostm(getcon("myname").value,getcon("mypswd").value);
            }
            else if(mresult === "NULL_NE")
            {
                alert("用户名出现问题。");
            }
            else
            {
                alert("发送成功！");
            }
        }

        async function addcostm(mname,mpswd)
        {
            var issuc = false;
            await $.ajax({
                url:"http://cloud.bmob.cn/974f094180354da9/add?name=" + mname + "&password=" + mpswd,
                type: 'GET',
                dataType: 'jsonp',
                jsonp: 'callback',
                jsonpCallback:"callbackFunction",
                success:function(result) {
                    if (result !== "NULL"){
                        issuc = true;
                    }
                    // issuc = true;
                }
            });
            alert((issuc?"注册成功！":"失败，或许已有该用户（请检查用户名或密码）。"));
        }
    </script>
</head>
<body> <!--onload="awake()"-->
<input id="mybtn" type="button"><!-- onclick="abc()"-->
<input id="myname" type="text">
<input id="mypswd" type="text">
<input id="mylabsend" type="text">
<input id="mylabget" type="text">
<div id="mygetmess">

</div>
</body>
</html>